<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

  <property name="blob_type" value="bytea" dbms="h2"/>
  <property name="blob_type" value="bytea" dbms="postgresql"/>
  <property name="blob_type" value="blob" dbms="oracle"/>
  <property name="blob_type" value="varbinary(max)" dbms="mssql"/>
  <property name="now" value="now()" dbms="h2"/>
  <property name="now" value="now()" dbms="postgresql"/>
  <property name="now" value="sysdate" dbms="oracle"/>
  <property name="now" value="CURRENT_TIMESTAMP" dbms="mssql"/>

  <changeSet id="inception-operations-1.0.0" author="Marcus Portmann">
    <comment>inception-operations-1.0.0</comment>

    <createTable tableName="operations_events" remarks="Events">
      <column name="id" type="uuid" remarks="The ID for the event">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the event is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="status" type="nvarchar(50)"
        remarks="The code for the status of the event">
        <constraints nullable="false"/>
      </column>
      <column name="object_type" type="nvarchar(50)"
        remarks="The code for the type of object the event is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="object_id" type="uuid"
        remarks="The ID for the object the event is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="type" type="nvarchar(50)"
        remarks="The code for the event type">
        <constraints nullable="false"/>
      </column>
      <column name="occurred" type="timestamp with time zone"
        remarks="The date and time the event occurred">
        <constraints nullable="false"/>
      </column>
      <column name="actor" type="nvarchar(100)"
        remarks="The person or system who completed the action that led to the event">
        <constraints nullable="false"/>
      </column>
      <column name="processed" type="timestamp with time zone"
        remarks="The date and time the event was processed"/>
      <column name="processing_attempts" type="int" defaultValue="0"
        remarks="The number of times the processing of the event has been attempted">
        <constraints nullable="false"/>
      </column>
      <column name="locked" type="timestamp with time zone"
        remarks="The date and time the event was locked for processing"/>
      <column name="lock_name" type="nvarchar(100)"
        remarks="The name of the entity that has locked the event for processing"/>
      <column name="last_processed" type="timestamp with time zone"
        remarks="The date and time the last attempt was made to process the event"/>
    </createTable>
    <createIndex indexName="operations_events_object_ix"
      tableName="operations_events">
      <column name="object_type"/>
      <column name="object_id"/>
    </createIndex>
    <createIndex indexName="operations_events_object_id_ix"
      tableName="operations_events">
      <column name="object_id"/>
    </createIndex>
    <createIndex indexName="operations_events_tenant_id_ix"
      tableName="operations_events">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_external_reference_types" remarks="External Reference Types">
      <column name="code" type="nvarchar(50)" remarks="The code for the external reference type">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="object_type" type="nvarchar(50)" remarks="The code for the type of object the external reference type is specific to"/>
      <column name="tenant_id" type="uuid" remarks="The ID for the tenant the external reference type is specific to"/>
      <column name="name" type="nvarchar(100)" remarks="The name of the external reference type">
        <constraints nullable="false"/>
      </column>
      <column name="description" type="nvarchar(200)" defaultValue="" remarks="The description for the external reference type">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <createIndex indexName="operations_external_reference_types_tenant_id_ix"
      tableName="operations_external_reference_types">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_external_references" remarks="External References">
      <column name="object_id" type="uuid" remarks="The ID for the object the external reference is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="object_type" type="nvarchar(50)" remarks="The code for the type of object the external reference is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="type" type="nvarchar(50)" remarks="The code for the external reference type">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="value" type="nvarchar(200)" remarks="The value for the external reference">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <createIndex indexName="operations_external_references_object_ix"
      tableName="operations_external_references">
      <column name="object_id"/>
      <column name="object_type"/>
    </createIndex>
    <createIndex indexName="operations_external_references_object_id_ix"
      tableName="operations_external_references">
      <column name="object_id"/>
    </createIndex>
    <createIndex indexName="operations_external_references_value_ix"
      tableName="operations_external_references">
      <column name="value"/>
    </createIndex>

    <createTable tableName="operations_document_definition_categories"
      remarks="Document Definition Categories">
      <column name="id" type="nvarchar(50)" remarks="The ID for the document definition category">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the document definition category is specific to"/>
      <column name="name" type="nvarchar(100)"
        remarks="The name of the document definition category">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <createIndex indexName="operations_document_definition_categories_tenant_id_ix"
      tableName="operations_document_definition_categories">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_document_definitions" remarks="Document Definitions">
      <column name="id" type="nvarchar(50)" remarks="The ID for the document definition">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="category_id" type="nvarchar(50)"
        remarks="The ID for the document definition category the document definition is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the document definition is specific to"/>
      <column name="name" type="nvarchar(100)" remarks="The name of the document definition">
        <constraints nullable="false"/>
      </column>
      <column name="required_document_attributes" type="nvarchar(510)"
        remarks="The comma-delimited list of codes for the required attributes for a document associated with the document definition"/>
    </createTable>
    <addForeignKeyConstraint
      constraintName="operations_document_definitions_document_definition_category_fk"
      baseTableName="operations_document_definitions" baseColumnNames="category_id"
      referencedTableName="operations_document_definition_categories" referencedColumnNames="id"
      onDelete="CASCADE"/>
    <createIndex indexName="operations_document_definitions_category_id_ix"
      tableName="operations_document_definitions">
      <column name="category_id"/>
    </createIndex>
    <createIndex indexName="operations_document_definitions_tenant_id_ix"
      tableName="operations_document_definitions">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_document_attribute_definitions"
      remarks="Document Attribute Definitions">
      <column name="code" type="nvarchar(50)" remarks="The code for the document attribute">
        <constraints primaryKey="true" nullable="false" unique="true"/>
      </column>
      <column name="document_definition_id" type="nvarchar(50)"
        remarks="The ID for the document definition the document attribute definition is specific to"/>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the document attribute definition is specific to"/>
      <column name="description" type="nvarchar(200)" defaultValue=""
        remarks="The description for the document attribute">
        <constraints nullable="false"/>
      </column>
      <column name="required" type="boolean"
        remarks="Is the document attribute required">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <createIndex indexName="operations_document_attribute_definitions_document_definition_id_ix"
      tableName="operations_document_attribute_definitions">
      <column name="document_definition_id"/>
    </createIndex>
    <createIndex indexName="operations_document_attribute_definitions_tenant_id_ix"
      tableName="operations_document_attribute_definitions">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_form_definitions" remarks="Form Definitions">
      <column name="id" type="nvarchar(50)" remarks="The ID for the form definition">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="name" type="nvarchar(100)" remarks="The name of the form definition">
        <constraints nullable="false"/>
      </column>
      <column name="type" type="nvarchar(50)" remarks="The code for the form type for the form definition">
        <constraints nullable="false"/>
      </column>
      <column name="data" type="clob" remarks="The JSON or XML data for the form definition">
        <constraints nullable="false"/>
      </column>
    </createTable>







    <createTable tableName="operations_workflow_engines" remarks="Workflow Engines">
      <column name="id" type="nvarchar(50)" remarks="The ID for the workflow engine">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="name" type="nvarchar(100)" remarks="The name of the workflow engine">
        <constraints nullable="false"/>
      </column>
      <column name="connector_class_name" type="nvarchar(500)"
        remarks="The fully qualified name of the connector class for the workflow engine">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <createTable tableName="operations_workflow_engine_attributes"
      remarks="Workflow Engine Attributes">
      <column name="engine_id" type="nvarchar(50)"
        remarks="The ID for the workflow engine the workflow engine attribute is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="code" type="nvarchar(50)" remarks="The code for the workflow engine attribute">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="value" type="nvarchar(1000)"
        remarks="The value for the workflow engine attribute">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint
      constraintName="operations_workflow_engine_attributes_workflow_engine_fk"
      baseTableName="operations_workflow_engine_attributes" baseColumnNames="engine_id"
      referencedTableName="operations_workflow_engines" referencedColumnNames="id"
      onDelete="CASCADE"/>
    <createIndex indexName="operations_workflow_engine_attributes_engine_id_ix"
      tableName="operations_workflow_engine_attributes">
      <column name="engine_id"/>
    </createIndex>

    <createTable tableName="operations_workflow_definition_categories"
      remarks="Workflow Definition Categories">
      <column name="id" type="nvarchar(50)" remarks="The ID for the workflow definition category">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the workflow definition category is specific to"/>
      <column name="name" type="nvarchar(100)"
        remarks="The name of the workflow definition category">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <createIndex indexName="operations_workflow_definition_categories_tenant_id_ix"
      tableName="operations_workflow_definition_categories">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_workflow_definitions" remarks="Workflow Definitions">
      <column name="id" type="nvarchar(50)" remarks="The ID for the workflow definition">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="version" type="int" remarks="The version of the workflow definition">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="category_id" type="nvarchar(50)"
        remarks="The ID for the workflow definition category the workflow definition is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the workflow definition is specific to"/>
      <column name="name" type="nvarchar(100)" remarks="The name of the workflow definition">
        <constraints nullable="false"/>
      </column>
      <column name="engine_id" type="nvarchar(50)"
        remarks="The ID for the workflow engine the workflow definition is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="time_to_complete" type="nvarchar(50)"
        remarks="The ISO-8601 duration format amount of time to complete a workflow associated with the workflow definition"/>
      <column name="supported_workflow_form_types" type="nvarchar(510)"
        remarks="The comma-delimited list of codes for the supported workflow form types for the workflow definition"/>
      <column name="validation_schema_type" type="nvarchar(50)"
        remarks="The schema type for the workflow definition"/>
      <column name="validation_schema" type="clob"
        remarks="The JSON or XML (XSD) schema for the workflow definition"/>
    </createTable>
    <addForeignKeyConstraint
      constraintName="operations_workflow_definitions_workflow_definition_category_fk"
      baseTableName="operations_workflow_definitions" baseColumnNames="category_id"
      referencedTableName="operations_workflow_definition_categories" referencedColumnNames="id"
      onDelete="CASCADE"/>
    <addForeignKeyConstraint constraintName="operations_workflow_definitions_workflow_engine_fk"
      baseTableName="operations_workflow_definitions" baseColumnNames="engine_id"
      referencedTableName="operations_workflow_engines" referencedColumnNames="id"
      onDelete="CASCADE"/>
    <createIndex indexName="operations_workflow_definitions_category_id_ix"
      tableName="operations_workflow_definitions">
      <column name="category_id"/>
    </createIndex>
    <createIndex indexName="operations_workflow_definitions_tenant_id_ix"
      tableName="operations_workflow_definitions">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_workflow_definition_attributes"
      remarks="Workflow Definition Attributes">
      <column name="definition_id" type="nvarchar(50)"
        remarks="The ID for the workflow definition the workflow definition attribute is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="definition_version" type="integer"
        remarks="The version of the workflow definition the workflow definition attribute is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="code" type="nvarchar(50)"
        remarks="The code for the workflow definition attribute">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="value" type="nvarchar(1000)"
        remarks="The value for the workflow definition attribute">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint
      constraintName="operations_workflow_definition_attributes_workflow_definition_fk"
      baseTableName="operations_workflow_definition_attributes"
      baseColumnNames="definition_id,definition_version"
      referencedTableName="operations_workflow_definitions" referencedColumnNames="id,version"
      onDelete="CASCADE"/>
    <createIndex indexName="operations_workflow_definition_attributes_workflow_definition_ix"
      tableName="operations_workflow_definition_attributes">
      <column name="definition_id"/>
      <column name="definition_version"/>
    </createIndex>

    <createTable tableName="operations_workflow_definition_permissions"
      remarks="Workflow Definition Permissions">
      <column name="definition_id" type="nvarchar(50)"
        remarks="The ID for the workflow definition the workflow definition permission is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="definition_version" type="integer"
        remarks="The version of the workflow definition the workflow definition permission is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="role_code" type="nvarchar(100)"
        remarks="The code for the role the workflow definition permission is assigned to">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="type" type="nvarchar(50)"
        remarks="The code for the workflow permission type for the workflow definition permission">
        <constraints primaryKey="true" nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint
      constraintName="operations_workflow_definition_permissions_workflow_definition_fk"
      baseTableName="operations_workflow_definition_permissions"
      baseColumnNames="definition_id,definition_version"
      referencedTableName="operations_workflow_definitions" referencedColumnNames="id,version"
      onDelete="CASCADE"/>
    <createIndex indexName="operations_workflow_definition_permissions_definition_ix"
      tableName="operations_workflow_definition_permissions">
      <column name="definition_id"/>
      <column name="definition_version"/>
    </createIndex>

    <createTable tableName="operations_workflow_attribute_definitions"
      remarks="Workflow Attribute Definitions">
      <column name="code" type="nvarchar(50)" remarks="The code for the workflow attribute">
        <constraints primaryKey="true" nullable="false" unique="true"/>
      </column>
      <column name="workflow_definition_id" type="nvarchar(50)"
        remarks="The ID for the workflow definition the workflow attribute definition is specific to"/>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the workflow attribute definition is specific to"/>
      <column name="description" type="nvarchar(200)" defaultValue=""
        remarks="The description for the workflow attribute">
        <constraints nullable="false"/>
      </column>
      <column name="required" type="boolean"
        remarks="Is the workflow attribute required">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <createIndex indexName="operations_workflow_attribute_definitions_workflow_definition_id_ix"
      tableName="operations_workflow_attribute_definitions">
      <column name="workflow_definition_id"/>
    </createIndex>
    <createIndex indexName="operations_workflow_attribute_definitions_tenant_id_ix"
      tableName="operations_workflow_attribute_definitions">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_workflow_step_definitions"
      remarks="Workflow Step Definitions">
      <column name="definition_id" type="nvarchar(50)"
        remarks="The ID for the workflow definition the workflow step definition is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="definition_version" type="integer"
        remarks="The version of the workflow definition the workflow step definition is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="code" type="nvarchar(50)" remarks="The code for the workflow step">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="sequence" type="integer" remarks="The sequence number for the workflow step">
        <constraints nullable="false"/>
      </column>
      <column name="name" type="nvarchar(100)" remarks="The name of the workflow step">
        <constraints nullable="false"/>
      </column>
      <column name="description" type="nvarchar(200)" defaultValue=""
        remarks="The description for the workflow step">
        <constraints nullable="false"/>
      </column>
      <column name="external" type="boolean"
        remarks="Is this workflow step completed by one or more external users">
        <constraints nullable="false"/>
      </column>
      <column name="internal" type="boolean"
        remarks="Is this workflow step internal-only and excluded for external users">
        <constraints nullable="false"/>
      </column>
      <column name="time_to_complete" type="nvarchar(50)"
        remarks="The ISO-8601 duration format amount of time to complete the workflow step"/>
    </createTable>
    <addForeignKeyConstraint
      constraintName="operations_workflow_step_definitions_workflow_definition_fk"
      baseTableName="operations_workflow_step_definitions"
      baseColumnNames="definition_id,definition_version"
      referencedTableName="operations_workflow_definitions" referencedColumnNames="id,version"
      onDelete="CASCADE"/>
    <createIndex indexName="operations_workflow_step_definitions_definition_ix"
      tableName="operations_workflow_step_definitions">
      <column name="definition_id"/>
      <column name="definition_version"/>
    </createIndex>

    <createTable tableName="operations_workflow_variable_definitions"
      remarks="Workflow Variable Definitions">
      <column name="definition_id" type="nvarchar(50)"
        remarks="The ID for the workflow definition the workflow variable definition is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="definition_version" type="integer"
        remarks="The version of the workflow definition the workflow variable definition is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="name" type="nvarchar(100)" remarks="The name of the workflow variable">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="required" type="boolean"
        remarks="Is the workflow variable required">
        <constraints nullable="false"/>
      </column>
      <column name="description" type="nvarchar(200)" remarks="The description for the workflow variable"/>
    </createTable>
    <addForeignKeyConstraint
      constraintName="operations_workflow_variable_definitions_workflow_definition_fk"
      baseTableName="operations_workflow_variable_definitions"
      baseColumnNames="definition_id,definition_version"
      referencedTableName="operations_workflow_definitions" referencedColumnNames="id,version"
      onDelete="CASCADE"/>
    <createIndex indexName="operations_workflow_variable_definitions_definition_ix"
      tableName="operations_workflow_variable_definitions">
      <column name="definition_id"/>
      <column name="definition_version"/>
    </createIndex>



    <createTable tableName="operations_workflow_definition_document_definitions"
      remarks="Workflow Definition Document Definitions">
      <column name="workflow_definition_id" type="nvarchar(50)"
        remarks="The ID for the workflow definition">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="workflow_definition_version" type="integer"
        remarks="The version of the workflow definition">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="document_definition_id" type="nvarchar(50)"
        remarks="The ID for the document definition">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="required" type="boolean"
        remarks="Is a document with the document definition ID required for a workflow with the workflow definition ID and workflow definition version">
        <constraints nullable="false"/>
      </column>
      <column name="singular" type="boolean"
        remarks="Is a workflow with the workflow definition ID and workflow definition version limited to a single document with the document definition ID">
        <constraints nullable="false"/>
      </column>
      <column name="verifiable" type="boolean"
        remarks="Should a document with the document definition ID be manually or automatically verified after being provided for a workflow with the workflow definition ID and workflow definition version">
        <constraints nullable="false"/>
      </column>
      <column name="validity_period" type="nvarchar(50)"
        remarks="The ISO-8601 duration format validity period from a document's issue date during which the document, with the document definition ID, can be associated with a workflow with the workflow definition ID and workflow definition version"/>
    </createTable>
    <addForeignKeyConstraint
      constraintName="operations_workflow_definition_document_definitions_workflow_definition_fk"
      baseTableName="operations_workflow_definition_document_definitions"
      baseColumnNames="workflow_definition_id,workflow_definition_version"
      referencedTableName="operations_workflow_definitions" referencedColumnNames="id,version"
      onDelete="CASCADE"/>
    <addForeignKeyConstraint
      constraintName="operations_workflow_definition_document_definitions_document_definition_fk"
      baseTableName="operations_workflow_definition_document_definitions"
      baseColumnNames="document_definition_id"
      referencedTableName="operations_document_definitions" referencedColumnNames="id"
      onDelete="CASCADE"/>
    <createIndex
      indexName="operations_workflow_definition_document_definitions_document_definition_id_ix"
      tableName="operations_workflow_definition_document_definitions">
      <column name="document_definition_id"/>
    </createIndex>
    <createIndex
      indexName="operations_workflow_definition_document_definitions_workflow_definition_ix"
      tableName="operations_workflow_definition_document_definitions">
      <column name="workflow_definition_id"/>
      <column name="workflow_definition_version"/>
    </createIndex>

    <createTable tableName="operations_workflows" remarks="Workflows">
      <column name="id" type="uuid" remarks="The ID for the workflow">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the workflow is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="parent_id" type="uuid" remarks="The ID for the parent workflow"/>
      <column name="definition_id" type="nvarchar(50)"
        remarks="The ID for the workflow definition the workflow is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="definition_version" type="int"
        remarks="The version of the workflow definition the workflow is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="status" type="nvarchar(50)" remarks="The code for the status of the workflow">
        <constraints nullable="false"/>
      </column>
      <column name="party_id" type="uuid"
        remarks="The ID for the party the workflow is associated with"/>
      <column name="engine_instance_id" type="nvarchar(100)"
        remarks="The ID of the corresponding process or case instance in the workflow engine"/>
      <column name="data" type="clob"
        remarks="The XML or JSON data for the workflow if not stored in an external repository"/>
      <column name="initiated" type="timestamp with time zone"
        remarks="The date and time the workflow was initiated">
        <constraints nullable="false"/>
      </column>
      <column name="initiated_by" type="nvarchar(100)"
        remarks="The person or system who initiated the workflow">
        <constraints nullable="false"/>
      </column>
      <column name="suspended" type="timestamp with time zone"
        remarks="The date and time the workflow was suspended"/>
      <column name="suspended_by" type="nvarchar(100)"
        remarks="The person or system who suspended the workflow"/>
      <column name="finalized" type="timestamp with time zone"
        remarks="The date and time the workflow was finalized"/>
      <column name="finalized_by" type="nvarchar(100)"
        remarks="The person or system who finalized the workflow"/>
      <column name="canceled" type="timestamp with time zone"
        remarks="The date and time the workflow was canceled"/>
      <column name="canceled_by" type="nvarchar(100)"
        remarks="The person or system who canceled the workflow"/>
      <column name="cancellation_reason" type="nvarchar(200)"
        remarks="The reason the workflow was canceled"/>
      <column name="updated" type="timestamp with time zone"
        remarks="The date and time the workflow was last updated"/>
      <column name="updated_by" type="nvarchar(100)"
        remarks="The person or system who last updated the workflow"/>
    </createTable>
    <addForeignKeyConstraint constraintName="operations_workflows_workflow_definition_fk"
      baseTableName="operations_workflows" baseColumnNames="definition_id,definition_version"
      referencedTableName="operations_workflow_definitions" referencedColumnNames="id,version"
      onDelete="RESTRICT"/>
    <createIndex indexName="operations_workflows_workflow_definition_ix"
      tableName="operations_workflows">
      <column name="definition_id"/>
      <column name="definition_version"/>
    </createIndex>
    <createIndex indexName="operations_workflows_definition_id_ix"
      tableName="operations_workflows">
      <column name="definition_id"/>
    </createIndex>
    <createIndex indexName="operations_workflows_engine_instance_id_ix"
      tableName="operations_workflows">
      <column name="engine_instance_id"/>
    </createIndex>
    <createIndex indexName="operations_workflows_parent_id_ix"
      tableName="operations_workflows">
      <column name="parent_id"/>
    </createIndex>
    <createIndex indexName="workflows_party_id_ix"
      tableName="operations_workflows">
      <column name="party_id"/>
    </createIndex>
    <createIndex indexName="operations_workflows_tenant_id_ix"
      tableName="operations_workflows">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_workflow_attributes" remarks="Workflow Attributes">
      <column name="workflow_id" type="uuid"
        remarks="The ID for the workflow the workflow attribute is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="code" type="nvarchar(50)" remarks="The code for the workflow attribute">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="value" type="nvarchar(1000)" remarks="The value for the workflow attribute">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint constraintName="operations_workflow_attributes_workflow_fk"
      baseTableName="operations_workflow_attributes" baseColumnNames="workflow_id"
      referencedTableName="operations_workflows" referencedColumnNames="id" onDelete="CASCADE"/>
    <createIndex indexName="operations_workflow_attributes_workflow_id_ix"
      tableName="operations_workflow_attributes">
      <column name="workflow_id"/>
    </createIndex>
    <createIndex indexName="operations_workflow_attributes_value_ix"
      tableName="operations_workflow_attributes">
      <column name="value"/>
    </createIndex>

    <createTable tableName="operations_workflow_notes" remarks="Workflow Notes">
      <column name="id" type="uuid" remarks="The ID for the workflow note">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the workflow note is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="workflow_id" type="uuid"
        remarks="The ID for the workflow the workflow note is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="content" type="nvarchar(2000)" remarks="The content for the workflow note">
        <constraints nullable="false"/>
      </column>
      <column name="created" type="timestamp with time zone"
        remarks="The date and time the workflow note was created">
        <constraints nullable="false"/>
      </column>
      <column name="created_by" type="nvarchar(100)"
        remarks="The person or system who created the workflow note">
        <constraints nullable="false"/>
      </column>
      <column name="updated" type="timestamp with time zone"
        remarks="The date and time the workflow note was last updated"/>
      <column name="updated_by" type="nvarchar(100)"
        remarks="The person or system who last updated the workflow note"/>
    </createTable>
    <addForeignKeyConstraint constraintName="operations_workflow_notes_workflow_fk"
      baseTableName="operations_workflow_notes" baseColumnNames="workflow_id"
      referencedTableName="operations_workflows" referencedColumnNames="id" onDelete="CASCADE"/>
    <createIndex indexName="operations_workflow_notes_workflow_id_ix"
      tableName="operations_workflow_notes">
      <column name="workflow_id"/>
    </createIndex>
    <createIndex indexName="operations_workflow_notes_tenant_id_ix"
      tableName="operations_workflow_notes">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_workflow_steps" remarks="Workflow Steps">
      <column name="workflow_id" type="uuid"
        remarks="The ID for the workflow the workflow step is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="code" type="nvarchar(50)" remarks="The code for the workflow step">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="status" type="nvarchar(50)"
        remarks="The code for the status of the workflow step">
        <constraints nullable="false"/>
      </column>
      <column name="initiated" type="timestamp with time zone"
        remarks="The date and time the workflow step was initiated">
        <constraints nullable="false"/>
      </column>
      <column name="suspended" type="timestamp with time zone"
        remarks="The date and time the workflow step was suspended"/>
      <column name="finalized" type="timestamp with time zone"
        remarks="The date and time the workflow step was finalized"/>
      <column name="canceled" type="timestamp with time zone"
        remarks="The date and time the workflow step was canceled"/>
    </createTable>
    <addForeignKeyConstraint constraintName="operations_workflow_steps_workflow_fk"
      baseTableName="operations_workflow_steps" baseColumnNames="workflow_id"
      referencedTableName="operations_workflows" referencedColumnNames="id" onDelete="CASCADE"/>
    <createIndex indexName="operations_workflow_steps_workflow_id_ix"
      tableName="operations_workflow_steps">
      <column name="workflow_id"/>
    </createIndex>

    <createTable tableName="operations_workflow_variables" remarks="Workflow Variables">
      <column name="workflow_id" type="uuid"
        remarks="The ID for the workflow the workflow variable is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="name" type="nvarchar(255)" remarks="The name of the workflow variable">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="type" type="nvarchar(50)" remarks="The code for the variable type for the workflow variable">
        <constraints nullable="false"/>
      </column>
      <column name="value" type="nvarchar(4000)" remarks="The value for the workflow variable"/>
    </createTable>
    <addForeignKeyConstraint constraintName="operations_workflow_variables_workflow_fk"
      baseTableName="operations_workflow_variables" baseColumnNames="workflow_id"
      referencedTableName="operations_workflows" referencedColumnNames="id" onDelete="CASCADE"/>
    <createIndex indexName="operations_workflow_variables_workflow_id_ix"
      tableName="operations_workflow_variables">
      <column name="workflow_id"/>
    </createIndex>
    <createIndex indexName="operations_workflow_variables_name_ix"
      tableName="operations_workflow_variables">
      <column name="name"/>
    </createIndex>    

    <createTable tableName="operations_documents" remarks="Documents">
      <column name="id" type="uuid" remarks="The ID for the document">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the document is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="definition_id" type="nvarchar(50)"
        remarks="The ID for the document definition the document is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="file_type" type="nvarchar(50)"
        remarks="The code for the file type for the document">
        <constraints nullable="false"/>
      </column>
      <column name="name" type="nvarchar(200)" remarks="The name of the document">
        <constraints nullable="false"/>
      </column>
      <column name="hash" type="nvarchar(50)"
        remarks="The base-64 encoded SHA-256 hash of the data for the document">
        <constraints nullable="false"/>
      </column>
      <column name="issue_date" type="date" remarks="The issue date for the document"/>
      <column name="expiry_date" type="date" remarks="The expiry date for the document"/>
      <column name="source_document_id" type="uuid"
        remarks="The ID for the source document that was split to create this document"/>
      <column name="data" type="${blob_type}"
        remarks="The data for the document if not stored in an external repository"/>
      <column name="created" type="timestamp with time zone"
        remarks="The date and time the document was created">
        <constraints nullable="false"/>
      </column>
      <column name="created_by" type="nvarchar(100)"
        remarks="The person or system who created the document">
        <constraints nullable="false"/>
      </column>
      <column name="updated" type="timestamp with time zone"
        remarks="The date and time the document was last updated"/>
      <column name="updated_by" type="nvarchar(100)"
        remarks="The person or system who last updated the document"/>
    </createTable>
    <addForeignKeyConstraint constraintName="operations_documents_document_definition_fk"
      baseTableName="operations_documents" baseColumnNames="definition_id"
      referencedTableName="operations_document_definitions" referencedColumnNames="id"
      onDelete="RESTRICT"/>
    <createIndex indexName="operations_documents_definition_id_ix"
      tableName="operations_documents">
      <column name="definition_id"/>
    </createIndex>
    <createIndex indexName="operations_documents_tenant_id_ix"
      tableName="operations_documents">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_document_attributes" remarks="Document Attributes">
      <column name="document_id" type="uuid"
        remarks="The ID for the document the document attribute is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="code" type="nvarchar(50)" remarks="The code for the document attribute">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="value" type="nvarchar(1000)" remarks="The value for the document attribute">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint constraintName="operations_document_attributes_document_fk"
      baseTableName="operations_document_attributes" baseColumnNames="document_id"
      referencedTableName="operations_documents" referencedColumnNames="id" onDelete="CASCADE"/>
    <createIndex indexName="operations_document_attributes_document_id_ix"
      tableName="operations_document_attributes">
      <column name="document_id"/>
    </createIndex>
    <createIndex indexName="operations_document_attributes_value_ix"
      tableName="operations_document_attributes">
      <column name="value"/>
    </createIndex>

    <createTable tableName="operations_document_notes" remarks="Document Notes">
      <column name="id" type="uuid" remarks="The ID for the document note">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the document note is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="document_id" type="uuid"
        remarks="The ID for the document the document note is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="content" type="nvarchar(2000)" remarks="The content for the document note">
        <constraints nullable="false"/>
      </column>
      <column name="created" type="timestamp with time zone"
        remarks="The date and time the document note was created">
        <constraints nullable="false"/>
      </column>
      <column name="created_by" type="nvarchar(100)"
        remarks="The person or system who created the document note">
        <constraints nullable="false"/>
      </column>
      <column name="updated" type="timestamp with time zone"
        remarks="The date and time the document note was last updated"/>
      <column name="updated_by" type="nvarchar(100)"
        remarks="The person or system who last updated the document note"/>
    </createTable>
    <addForeignKeyConstraint constraintName="operations_document_notes_document_fk"
      baseTableName="operations_document_notes" baseColumnNames="document_id"
      referencedTableName="operations_documents" referencedColumnNames="id" onDelete="CASCADE"/>
    <createIndex indexName="operations_document_notes_document_id_ix"
      tableName="operations_document_notes">
      <column name="document_id"/>
    </createIndex>
    <createIndex indexName="operations_document_notes_tenant_id_ix"
      tableName="operations_document_notes">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_workflow_documents" remarks="Workflow Documents">
      <column name="id" type="uuid" remarks="The ID for the workflow document">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the workflow document is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="workflow_id" type="uuid" remarks="The ID for the workflow">
        <constraints nullable="false"/>
      </column>
      <column name="document_definition_id" type="nvarchar(50)"
        remarks="The ID for the document definition the workflow document is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="document_id" type="uuid" remarks="The ID for the document"/>
      <column name="status" type="nvarchar(50)"
        remarks="The code for the status of the workflow document">
        <constraints nullable="false"/>
      </column>
      <column name="requested" type="timestamp with time zone"
        remarks="The date and time the workflow document was requested">
        <constraints nullable="false"/>
      </column>
      <column name="requested_by" type="nvarchar(100)"
        remarks="The person or system that requested the workflow document">
        <constraints nullable="false"/>
      </column>
      <column name="requested_from_party_id" type="uuid"
        remarks="The ID for the party the workflow document was requested from"/>
      <column name="provided" type="timestamp with time zone"
        remarks="The date and time the workflow document was provided"/>
      <column name="provided_by" type="nvarchar(100)"
        remarks="The person or system that provided the workflow document"/>
      <column name="rejected" type="timestamp with time zone"
        remarks="The date and time the workflow document was rejected"/>
      <column name="rejected_by" type="nvarchar(100)"
        remarks="The person or system that rejected the workflow document"/>
      <column name="rejection_reason" type="nvarchar(500)"
        remarks="The reason the workflow document was rejected"/>
      <column name="verified" type="timestamp with time zone"
        remarks="The date and time the workflow document was verified"/>
      <column name="verified_by" type="nvarchar(100)"
        remarks="The person or system that verified the workflow document"/>
      <column name="description" type="nvarchar(500)"
        remarks="The description for the workflow document"/>
    </createTable>
    <addForeignKeyConstraint constraintName="operations_workflow_documents_workflow_fk"
      baseTableName="operations_workflow_documents" baseColumnNames="workflow_id"
      referencedTableName="operations_workflows" referencedColumnNames="id" onDelete="CASCADE"/>
    <addForeignKeyConstraint constraintName="operations_workflow_documents_document_definition_fk"
      baseTableName="operations_workflow_documents" baseColumnNames="document_definition_id"
      referencedTableName="operations_document_definitions" referencedColumnNames="id"
      onDelete="CASCADE"/>
    <addForeignKeyConstraint constraintName="operations_workflow_documents_document_fk"
      baseTableName="operations_workflow_documents" baseColumnNames="document_id"
      referencedTableName="operations_documents" referencedColumnNames="id" onDelete="CASCADE"/>
    <createIndex indexName="operations_workflow_documents_document_definition_id_ix"
      tableName="operations_workflow_documents">
      <column name="document_definition_id"/>
    </createIndex>
    <createIndex indexName="operations_workflow_documents_document_id_ix"
      tableName="operations_workflow_documents">
      <column name="document_id"/>
    </createIndex>
    <createIndex indexName="operations_workflow_documents_tenant_id_ix"
      tableName="operations_workflow_documents">
      <column name="tenant_id"/>
    </createIndex>
    <createIndex indexName="operations_workflow_documents_requested_from_party_id_ix"
      tableName="operations_workflow_documents">
      <column name="requested_from_party_id"/>
    </createIndex>
    <createIndex indexName="operations_workflow_documents_workflow_id_ix"
      tableName="operations_workflow_documents">
      <column name="workflow_id"/>
    </createIndex>

    <createTable tableName="operations_interaction_sources" remarks="Interaction Sources">
      <column name="id" type="uuid" remarks="The ID for the interaction source">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the interaction source is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="type" type="nvarchar(50)"
        remarks="The code for the interaction source type for the interaction source">
        <constraints nullable="false"/>
      </column>
      <column name="name" type="nvarchar(100)" remarks="The name of the interaction source">
        <constraints nullable="false"/>
      </column>
      <column name="enabled" type="boolean" remarks="Is the interaction source enabled">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <createIndex indexName="operations_interaction_sources_type_ix"
      tableName="operations_interaction_sources">
      <column name="type"/>
    </createIndex>
    <createIndex indexName="operations_interaction_sources_tenant_id_ix"
      tableName="operations_interaction_sources">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_interaction_source_attributes"
      remarks="Interaction Source Attributes">
      <column name="source_id" type="uuid"
        remarks="The ID for the interaction source the interaction source attribute is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="code" type="nvarchar(50)"
        remarks="The code for the interaction source attribute">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="value" type="nvarchar(1000)"
        remarks="The value for the interaction source attribute">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint
      constraintName="operations_interaction_source_attributes_interaction_source_fk"
      baseTableName="operations_interaction_source_attributes" baseColumnNames="source_id"
      referencedTableName="operations_interaction_sources" referencedColumnNames="id"
      onDelete="CASCADE"/>
    <createIndex indexName="operations_interaction_source_attributes_source_id_ix"
      tableName="operations_interaction_source_attributes">
      <column name="source_id"/>
    </createIndex>

    <createTable tableName="operations_interaction_source_permissions"
      remarks="Interaction Source Permissions">
      <column name="source_id" type="uuid"
        remarks="The ID for the interaction source the interaction source permission is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="role_code" type="nvarchar(100)"
        remarks="The code for the role the interaction source permission is assigned to">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="type" type="nvarchar(50)"
        remarks="The code for the interaction permission type for the interaction source permission">
        <constraints primaryKey="true" nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint
      constraintName="operations_interaction_source_permissions_interaction_source_fk"
      baseTableName="operations_interaction_source_permissions" baseColumnNames="source_id"
      referencedTableName="operations_interaction_sources" referencedColumnNames="id"
      onDelete="CASCADE"/>
    <createIndex indexName="operations_interaction_source_permissions_source_id_ix"
      tableName="operations_interaction_source_permissions">
      <column name="source_id"/>
    </createIndex>

    <createTable tableName="operations_interactions" remarks="Interactions">
      <column name="id" type="uuid" remarks="The ID for the interaction">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the interaction is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="status" type="nvarchar(50)"
        remarks="The code for the status of the interaction">
        <constraints nullable="false"/>
      </column>
      <column name="type" type="nvarchar(50)"
        remarks="The code for the interaction type for the interaction">
        <constraints nullable="false"/>
      </column>
      <column name="direction" type="nvarchar(50)"
        remarks="The code for the interaction direction for the interaction">
        <constraints nullable="false"/>
      </column>
      <column name="source_id" type="uuid"
        remarks="The ID for the interaction source the interaction is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="source_reference" type="nvarchar(400)"
        remarks="The interaction source specific reference for the interaction"/>
      <column name="conversation_id" type="nvarchar(30)"
        remarks="The ID for the conversation the interaction is associated with"/>
      <column name="party_id" type="uuid"
        remarks="The ID for the party the interaction is associated with"/>
      <column name="sender" type="nvarchar(255)"
        remarks="The identifier representing who the interaction is from, e.g. an email address, a mobile number, etc">
        <constraints nullable="false"/>
      </column>
      <column name="recipients" type="nvarchar(2000)"
        remarks="The colon-seperated list of identifiers representing the recipients for the interaction, e.g. email addresses, mobile numbers, etc">
        <constraints nullable="false"/>
      </column>
      <column name="subject" type="nvarchar(2000)" remarks="The subject for the interaction">
        <constraints nullable="false"/>
      </column>
      <column name="mime_type" type="nvarchar(50)"
        remarks="The mime type for the content for the interaction">
        <constraints nullable="false"/>
      </column>
      <column name="content" type="clob" remarks="The content for the interaction">
        <constraints nullable="false"/>
      </column>
      <column name="occurred" type="timestamp with time zone"
        remarks="The date and time the interaction occurred (received if inbound, sent if outbound)">
        <constraints nullable="false"/>
      </column>
      <column name="assigned" type="timestamp with time zone"
        remarks="The date and time the interaction was assigned"/>
      <column name="assigned_to" type="nvarchar(100)"
        remarks="The username for the user the interaction is assigned to"/>
      <column name="processed" type="timestamp with time zone"
        remarks="The date and time the interaction was processed"/>
      <column name="processing_attempts" type="int" defaultValue="0"
        remarks="The number of times the processing of the interaction has been attempted">
        <constraints nullable="false"/>
      </column>
      <column name="processing_time" type="bigint" defaultValueNumeric="0"
        remarks="The time taken to process the interaction in milliseconds">
        <constraints nullable="false"/>
      </column>
      <column name="locked" type="timestamp with time zone"
        remarks="The date and time the interaction was locked for processing"/>
      <column name="lock_name" type="nvarchar(100)"
        remarks="The name of the entity that has locked the interaction for processing"/>
      <column name="last_processed" type="timestamp with time zone"
        remarks="The date and time the last attempt was made to process the interaction"/>
    </createTable>
    <addForeignKeyConstraint constraintName="operations_interactions_interaction_source_fk"
      baseTableName="operations_interactions" baseColumnNames="source_id"
      referencedTableName="operations_interaction_sources" referencedColumnNames="id"
      onDelete="RESTRICT"/>
    <createIndex indexName="operations_interactions_assigned_to_ix"
      tableName="operations_interactions">
      <column name="assigned_to"/>
    </createIndex>
    <createIndex indexName="operations_interactions_conversation_id_ix"
      tableName="operations_interactions">
      <column name="conversation_id"/>
    </createIndex>
    <createIndex indexName="operations_interactions_direction_ix"
      tableName="operations_interactions">
      <column name="direction"/>
    </createIndex>
    <createIndex indexName="operations_interactions_party_id_ix"
      tableName="operations_interactions">
      <column name="party_id"/>
    </createIndex>
    <createIndex indexName="operations_interactions_source_id_ix"
      tableName="operations_interactions">
      <column name="source_id"/>
    </createIndex>
    <createIndex indexName="operations_interactions_source_id_source_reference_ix"
      tableName="operations_interactions">
      <column name="source_id"/>
      <column name="source_reference"/>
    </createIndex>
    <createIndex indexName="operations_interactions_status_ix"
      tableName="operations_interactions">
      <column name="status"/>
    </createIndex>
    <createIndex indexName="operations_interactions_tenant_id_ix"
      tableName="operations_interactions">
      <column name="tenant_id"/>
    </createIndex>
    <createIndex indexName="operations_interactions_occurred_ix"
      tableName="operations_interactions">
      <column name="occurred"/>
    </createIndex>

    <createTable tableName="operations_interaction_attachments" remarks="Interaction Attachments">
      <column name="id" type="uuid" remarks="The ID for the interaction attachment">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the interaction attachment is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="interaction_id" type="uuid"
        remarks="The ID for the interaction the interaction attachment is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="source_id" type="uuid"
        remarks="The ID for the interaction source the interaction attachment is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="source_reference" type="nvarchar(400)"
        remarks="The interaction source specific reference for the interaction attachment"/>
      <column name="file_type" type="nvarchar(50)"
        remarks="The code for the file type for the interaction attachment">
        <constraints nullable="false"/>
      </column>
      <column name="name" type="nvarchar(200)" remarks="The name of the interaction attachment">
        <constraints nullable="false"/>
      </column>
      <column name="hash" type="nvarchar(50)"
        remarks="The base-64 encoded SHA-256 hash of the data for the interaction attachment">
        <constraints nullable="false"/>
      </column>
      <column name="data" type="${blob_type}"
        remarks="The data for the interaction attachment if not stored in an external repository"/>
    </createTable>
    <addForeignKeyConstraint constraintName="operations_interaction_attachments_interaction_fk"
      baseTableName="operations_interaction_attachments" baseColumnNames="interaction_id"
      referencedTableName="operations_interactions" referencedColumnNames="id" onDelete="CASCADE"/>
    <addForeignKeyConstraint
      constraintName="operations_interaction_attachments_interaction_source_fk"
      baseTableName="operations_interaction_attachments" baseColumnNames="source_id"
      referencedTableName="operations_interaction_sources" referencedColumnNames="id"
      onDelete="RESTRICT"/>
    <createIndex indexName="operations_interaction_attachments_interaction_id_ix"
      tableName="operations_interaction_attachments">
      <column name="interaction_id"/>
    </createIndex>
    <createIndex indexName="operations_interaction_attachments_interaction_id_hash_ix"
      tableName="operations_interaction_attachments">
      <column name="interaction_id"/>
      <column name="hash"/>
    </createIndex>
    <createIndex indexName="operations_interaction_attachments_source_id_ix"
      tableName="operations_interaction_attachments">
      <column name="source_id"/>
    </createIndex>
    <createIndex indexName="operations_interaction_attachments_source_id_source_reference_ix"
      tableName="operations_interaction_attachments">
      <column name="source_id"/>
      <column name="source_reference"/>
    </createIndex>
    <createIndex indexName="operations_interaction_attachments_tenant_id_ix"
      tableName="operations_interaction_attachments">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_interaction_notes" remarks="Interaction Notes">
      <column name="id" type="uuid" remarks="The ID for the interaction note">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="tenant_id" type="uuid"
        remarks="The ID for the tenant the interaction note is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="interaction_id" type="uuid"
        remarks="The ID for the interaction the interaction note is associated with">
        <constraints nullable="false"/>
      </column>
      <column name="content" type="nvarchar(2000)" remarks="The content for the interaction note">
        <constraints nullable="false"/>
      </column>
      <column name="created" type="timestamp with time zone"
        remarks="The date and time the interaction note was created">
        <constraints nullable="false"/>
      </column>
      <column name="created_by" type="nvarchar(100)"
        remarks="The person or system who created the interaction note">
        <constraints nullable="false"/>
      </column>
      <column name="updated" type="timestamp with time zone"
        remarks="The date and time the interaction note was last updated"/>
      <column name="updated_by" type="nvarchar(100)"
        remarks="The person or system who last updated the interaction note"/>
    </createTable>
    <addForeignKeyConstraint constraintName="operations_interaction_notes_interaction_fk"
      baseTableName="operations_interaction_notes" baseColumnNames="interaction_id"
      referencedTableName="operations_interactions" referencedColumnNames="id" onDelete="CASCADE"/>
    <createIndex indexName="operations_interaction_notes_interaction_id_ix"
      tableName="operations_interaction_notes">
      <column name="interaction_id"/>
    </createIndex>
    <createIndex indexName="operations_interaction_notes_tenant_id_ix"
      tableName="operations_interaction_notes">
      <column name="tenant_id"/>
    </createIndex>

    <createTable tableName="operations_workflow_interaction_links"
      remarks="Workflow Interaction Links">
      <column name="workflow_id" type="uuid"
        remarks="The ID for the workflow the workflow interaction link is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="interaction_id" type="uuid"
        remarks="The ID for the interaction the workflow interaction link is associated with">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="linked" type="timestamp with time zone"
        remarks="The date and time the interaction was linked to the workflow">
        <constraints nullable="false"/>
      </column>
      <column name="linked_by" type="nvarchar(100)"
        remarks="The person or system who linked the interaction to the workflow">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint constraintName="operations_workflow_interaction_links_workflow_fk"
      baseTableName="operations_workflow_interaction_links" baseColumnNames="workflow_id"
      referencedTableName="operations_workflows" referencedColumnNames="id" onDelete="CASCADE"/>
    <addForeignKeyConstraint constraintName="operations_workflow_interaction_links_interaction_fk"
      baseTableName="operations_workflow_interaction_links" baseColumnNames="interaction_id"
      referencedTableName="operations_interactions" referencedColumnNames="id" onDelete="CASCADE"/>
    <createIndex indexName="operations_workflow_interaction_links_workflow_id_ix"
      tableName="operations_workflow_interaction_links">
      <column name="workflow_id"/>
    </createIndex>
    <createIndex indexName="operations_workflow_interaction_links_interaction_id_ix"
      tableName="operations_workflow_interaction_links">
      <column name="interaction_id"/>
    </createIndex>

    <insert tableName="operations_workflow_engines">
      <column name="id" value="dummy"/>
      <column name="name" value="Dummy"/>
      <column name="connector_class_name"
        value="digital.inception.operations.connector.DummyWorkflowEngineConnector"/>
    </insert>

    <insert tableName="operations_workflow_engines">
      <column name="id" value="flowable_embedded"/>
      <column name="name" value="Flowable Embedded"/>
      <column name="connector_class_name"
        value="digital.inception.operations.connector.FlowableEmbeddedWorkflowEngineConnector"/>
    </insert>

    <rollback>
      <delete tableName="operations_workflow_engines">
        <where>id = 'flowable_embedded'</where>
      </delete>

      <delete tableName="operations_workflow_engines">
        <where>id = 'dummy'</where>
      </delete>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_interaction_links"/>
      <dropIndex tableName="operations_workflow_interaction_links"
        indexName="operations_workflow_interaction_links_interaction_id_ix"/>
      <dropIndex tableName="operations_workflow_interaction_links"
        indexName="operations_workflow_interaction_links_workflow_id_ix"/>
      <dropTable tableName="operations_workflow_interaction_links"/>

      <dropAllForeignKeyConstraints baseTableName="operations_interaction_notes"/>
      <dropIndex tableName="operations_interaction_notes"
        indexName="operations_interaction_notes_tenant_id_ix"/>
      <dropIndex tableName="operations_interaction_notes"
        indexName="operations_interaction_notes_note_id_ix"/>
      <dropTable tableName="operations_interaction_notes"/>

      <dropAllForeignKeyConstraints baseTableName="operations_interaction_attachments"/>
      <dropIndex tableName="operations_interaction_attachments"
        indexName="operations_interaction_attachments_tenant_id_ix"/>
      <dropIndex tableName="operations_interaction_attachments"
        indexName="operations_interaction_attachments_source_id_source_reference_ix"/>
      <dropIndex tableName="operations_interaction_attachments"
        indexName="operations_interaction_attachments_source_id_ix"/>
      <dropIndex tableName="operations_interaction_attachments"
        indexName="operations_interaction_attachments_interaction_id_hash_ix"/>
      <dropIndex tableName="operations_interaction_attachments"
        indexName="operations_interaction_attachments_interaction_id_ix"/>
      <dropTable tableName="operations_interaction_attachments"/>

      <dropAllForeignKeyConstraints baseTableName="operations_interactions"/>
      <dropIndex tableName="operations_interactions"
        indexName="operations_interactions_occurred_ix"/>
      <dropIndex tableName="operations_interactions"
        indexName="operations_interactions_tenant_id_ix"/>
      <dropIndex tableName="operations_interactions"
        indexName="operations_interactions_status_ix"/>
      <dropIndex tableName="operations_interactions"
        indexName="operations_interactions_source_id_source_reference_ix"/>
      <dropIndex tableName="operations_interactions"
        indexName="operations_interactions_source_id_ix"/>
      <dropIndex tableName="operations_interactions"
        indexName="operations_interactions_party_id_ix"/>
      <dropIndex tableName="operations_interactions"
        indexName="operations_interactions_direction_ix"/>
      <dropIndex tableName="operations_interactions"
        indexName="operations_interactions_conversation_id_ix"/>
      <dropIndex tableName="operations_interactions"
        indexName="operations_interactions_assigned_to_ix"/>
      <dropTable tableName="operations_interactions"/>

      <dropAllForeignKeyConstraints baseTableName="operations_interaction_source_permissions"/>
      <dropIndex tableName="operations_interaction_source_permissions"
        indexName="operations_interaction_source_permissions_source_id_ix"/>
      <dropTable tableName="operations_interaction_source_permissions"/>

      <dropAllForeignKeyConstraints baseTableName="operations_interaction_source_attributes"/>
      <dropIndex tableName="operations_interaction_source_attributes"
        indexName="operations_interaction_source_attributes_source_id_ix"/>
      <dropTable tableName="operations_interaction_source_attributes"/>

      <dropAllForeignKeyConstraints baseTableName="operations_interaction_sources"/>
      <dropIndex tableName="operations_interactions"
        indexName="operations_interaction_sources_tenant_id_ix"/>
      <dropIndex tableName="operations_interactions"
        indexName="operations_interaction_sources_type_ix"/>
      <dropTable tableName="operations_interaction_sources"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_documents"/>
      <dropIndex tableName="operations_documents"
        indexName="operations_workflow_documents_requested_from_party_id_ix"/>
      <dropIndex tableName="operations_documents"
        indexName="operations_workflow_documents_workflow_id_ix"/>
      <dropIndex tableName="operations_documents"
        indexName="operations_workflow_documents_tenant_id_ix"/>
      <dropIndex tableName="operations_documents"
        indexName="operations_workflow_documents_document_id_ix"/>
      <dropIndex tableName="operations_documents"
        indexName="operations_workflow_documents_document_definition_id_ix"/>
      <dropTable tableName="operations_workflow_documents"/>

      <dropAllForeignKeyConstraints baseTableName="operations_document_notes"/>
      <dropIndex tableName="operations_document_notes"
        indexName="operations_document_notes_tenant_id_ix"/>
      <dropIndex tableName="operations_document_notes"
        indexName="operations_document_notes_document_id_ix"/>
      <dropTable tableName="operations_document_notes"/>

      <dropAllForeignKeyConstraints baseTableName="operations_documents"/>
      <dropIndex tableName="operations_documents"
        indexName="operations_documents_tenant_id_ix"/>
      <dropIndex tableName="operations_documents"
        indexName="operations_documents_definition_id_ix"/>
      <dropTable tableName="operations_documents"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_variables"/>
      <dropIndex tableName="operations_workflow_variables"
        indexName="operations_workflow_variables_workflow_id_ix"/>
      <dropIndex tableName="operations_workflow_variables"
        indexName="operations_workflow_variables_name_ix"/>
      <dropTable tableName="operations_workflow_variables"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_steps"/>
      <dropIndex tableName="operations_workflow_steps"
        indexName="operations_workflow_steps_workflow_id_ix"/>
      <dropTable tableName="operations_workflow_steps"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_notes"/>
      <dropIndex tableName="operations_workflow_notes"
        indexName="operations_workflow_notes_tenant_id_ix"/>
      <dropIndex tableName="operations_workflow_notes"
        indexName="operations_workflow_notes_workflow_id_ix"/>
      <dropTable tableName="operations_workflow_notes"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_attributes"/>
      <dropIndex tableName="operations_workflow_attributes"
        indexName="operations_workflow_attributes_workflow_id_ix"/>
      <dropIndex tableName="operations_workflow_attributes"
        indexName="operations_workflow_attributes_value_ix"/>
      <dropTable tableName="operations_workflow_attributes"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflows"/>
      <dropIndex tableName="operations_workflows"
        indexName="operations_workflows_tenant_id_ix"/>
      <dropIndex tableName="operations_workflows"
        indexName="operations_workflows_party_id_ix"/>
      <dropIndex tableName="operations_workflows"
        indexName="operations_workflows_parent_id_ix"/>
      <dropIndex tableName="operations_workflows"
        indexName="operations_workflows_engine_instance_id_ix"/>
      <dropIndex tableName="operations_workflows"
        indexName="operations_workflows_definition_id_ix"/>
      <dropIndex tableName="operations_workflows"
        indexName="operations_workflows_workflow_definition_ix"/>
      <dropTable tableName="operations_workflows"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_variable_definitions"/>
      <dropIndex tableName="operations_workflow_variable_definitions"
        indexName="operations_workflow_variable_definitions_definition_ix"/>
      <dropTable tableName="operations_workflow_variable_definitions"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_step_definitions"/>
      <dropIndex tableName="operations_workflow_step_definitions"
        indexName="operations_workflow_step_definitions_definition_ix"/>
      <dropTable tableName="operations_workflow_step_definitions"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_attribute_definitions"/>
      <dropIndex tableName="operations_workflow_attribute_definitions"
        indexName="operations_workflow_attribute_definitions_tenant_id_ix"/>
      <dropIndex tableName="operations_workflow_attribute_definitions"
        indexName="operations_workflow_attribute_definitions_workflow_definition_id_ix"/>
      <dropTable tableName="operations_workflow_attribute_definitions"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_definition_permissions"/>
      <dropIndex tableName="operations_workflow_definition_permissions"
        indexName="operations_workflow_definition_permissions_source_id_ix"/>
      <dropTable tableName="operations_workflow_definition_permissions"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_definition_attributes"/>
      <dropIndex tableName="operations_workflow_definition_attributes"
        indexName="operations_workflow_definition_attributes_workflow_definition_ix"/>
      <dropTable tableName="operations_workflow_definition_attributes"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_definitions"/>
      <dropIndex tableName="operations_workflow_definitions"
        indexName="operations_workflow_definitions_tenant_id_ix"/>
      <dropIndex tableName="operations_workflow_definitions"
        indexName="operations_workflow_definitions_category_id_ix"/>
      <dropTable tableName="operations_workflow_definitions"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_definition_categories"/>
      <dropIndex tableName="operations_workflow_definition_categories"
        indexName="operations_workflow_definition_categories_tenant_id_ix"/>
      <dropTable tableName="operations_workflow_definition_categories"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_engine_attributes"/>
      <dropIndex tableName="operations_workflow_engine_attributes"
        indexName="operations_workflow_engine_attributes_engine_id_ix"/>
      <dropTable tableName="operations_workflow_engine_attributes"/>

      <dropAllForeignKeyConstraints baseTableName="operations_workflow_engines"/>
      <dropTable tableName="operations_workflow_engines"/>

      <dropAllForeignKeyConstraints baseTableName="operations_form_definitions"/>
      <dropTable tableName="operations_form_definitions"/>

      <dropAllForeignKeyConstraints
        baseTableName="operations_workflow_definition_document_definitions"/>
      <dropIndex tableName="operations_workflow_definition_document_definitions"
        indexName="operations_workflow_definition_document_definitions_workflow_definition_ix"/>
      <dropIndex tableName="operations_workflow_definition_document_definitions"
        indexName="operations_workflow_definition_document_definitions_document_definition_id_ix"/>
      <dropTable tableName="operations_workflow_definition_document_definitions"/>

      <dropAllForeignKeyConstraints baseTableName="operations_document_attribute_definitions"/>
      <dropIndex tableName="operations_document_attribute_definitions"
        indexName="operations_document_attribute_definitions_tenant_id_ix"/>
      <dropIndex tableName="operations_document_attribute_definitions"
        indexName="operations_document_attribute_definitions_definition_id_ix"/>
      <dropTable tableName="operations_document_attribute_definitions"/>

      <dropAllForeignKeyConstraints baseTableName="operations_document_definitions"/>
      <dropIndex tableName="operations_document_definitions"
        indexName="operations_document_definitions_tenant_id_ix"/>
      <dropIndex tableName="operations_document_definitions"
        indexName="operations_document_definitions_category_id_ix"/>
      <dropTable tableName="operations_document_definitions"/>

      <dropAllForeignKeyConstraints baseTableName="operations_document_definition_categories"/>
      <dropIndex tableName="operations_document_definition_categories"
        indexName="operations_document_definition_categories_tenant_id_ix"/>
      <dropTable tableName="operations_document_definition_categories"/>

      <dropAllForeignKeyConstraints baseTableName="operations_external_references"/>
      <dropIndex tableName="operations_external_references"
        indexName="operations_external_references_value_ix"/>
      <dropIndex tableName="operations_external_references"
        indexName="operations_external_references_object_id_ix"/>
      <dropIndex tableName="operations_external_references"
        indexName="operations_external_references_object_ix"/>
      <dropTable tableName="operations_external_references"/>

      <dropAllForeignKeyConstraints baseTableName="operations_external_reference_types"/>
      <dropIndex tableName="operations_external_reference_types"
        indexName="operations_external_reference_types_tenant_id_ix"/>
      <dropTable tableName="operations_external_reference_types"/>

      <dropAllForeignKeyConstraints baseTableName="operations_events"/>
      <dropIndex tableName="operations_events"
        indexName="operations_events_tenant_id_ix"/>
      <dropIndex tableName="operations_events"
        indexName="operations_events_object_id_ix"/>
      <dropIndex tableName="operations_events"
        indexName="operations_events_object_ix"/>
      <dropTable tableName="operations_events"/>
    </rollback>
  </changeSet>

  <changeSet id="inception-operations-postgresql-1.0.0" author="Marcus Portmann" dbms="postgresql"
    runInTransaction="false">
    <comment>inception-operations-postgresql-1.0.0</comment>

    <!-- Enable pg_trgm (safe if already present) -->
    <sql>CREATE EXTENSION IF NOT EXISTS pg_trgm;</sql>

    <!-- Trigram GIN indexes on lower(value); CONCURRENTLY requires autocommit -->
    <sql>
      CREATE INDEX CONCURRENTLY IF NOT EXISTS operations_document_attributes_value_trgm_ix
        ON operations_document_attributes
          USING gin (lower(value) gin_trgm_ops);
    </sql>
    <sql>
      CREATE INDEX CONCURRENTLY IF NOT EXISTS operations_workflow_attributes_value_trgm_ix
        ON operations_workflow_attributes
          USING gin (lower(value) gin_trgm_ops);
    </sql>

    <rollback>
      <sql>DROP INDEX IF EXISTS operations_workflow_attributes_value_trgm_ix;</sql>
      <sql>DROP INDEX IF EXISTS operations_document_attributes_value_trgm_ix;</sql>
      <!-- Typically keep the extension; omit dropping pg_trgm -->
    </rollback>
  </changeSet>

  <changeSet id="inception-operations-oracle-1.0.0" author="Marcus Portmann" dbms="oracle">
    <comment>inception-operations-oracle-1.0.0</comment>

    <!-- Create/replace wordlists that enable leading/trailing wildcard & k-gram index -->
    <sql><![CDATA[
      DECLARE
        v_exists NUMBER;
      BEGIN
        -- Drop if exists to allow idempotence across environments
        SELECT COUNT(*)
        INTO v_exists
        FROM ctx_preferences
        WHERE PRE_NAME = 'OPERATIONS_DOCUMENT_ATTRIBUTES_VALUE_WORDLIST';
        IF v_exists > 0 THEN
          ctx_ddl.drop_preference('operations_document_attributes_value_wordlist');
        END IF;

        ctx_ddl.create_preference('operations_document_attributes_value_wordlist',
                                  'BASIC_WORDLIST');
        ctx_ddl.set_attribute('operations_document_attributes_value_wordlist', 'SUBSTRING_INDEX',
                              'TRUE');
        ctx_ddl.set_attribute('operations_document_attributes_value_wordlist', 'WILDCARD_INDEX',
                              'TRUE');
        -- Optional guardrails:
        -- ctx_ddl.set_attribute('operations_document_attributes_value_wordlist', 'WILDCARD_MAXTERMS', '5000');
      END;
      ]]></sql>

    <!-- CONTEXT index on VALUE; ON COMMIT keeps it up to date -->
    <sql><![CDATA[
      CREATE INDEX operations_document_attributes_value_ctx_idx
        ON operations_document_attributes (value)
        INDEXTYPE IS CTXSYS.CONTEXT
        PARAMETERS (
        'WORDLIST operations_document_attributes_value_wordlist
         SYNC (ON COMMIT)'
        );
      ]]>
    </sql>

    <sql><![CDATA[
      DECLARE
        v_exists NUMBER;
      BEGIN
        -- Drop if exists to allow idempotence across environments
        SELECT COUNT(*)
        INTO v_exists
        FROM ctx_preferences
        WHERE PRE_NAME = 'OPERATIONS_WORKFLOW_ATTRIBUTES_VALUE_WORDLIST';
        IF v_exists > 0 THEN
          ctx_ddl.drop_preference('operations_workflow_attributes_value_wordlist');
        END IF;

        ctx_ddl.create_preference('operations_workflow_attributes_value_wordlist',
                                  'BASIC_WORDLIST');
        ctx_ddl.set_attribute('operations_workflow_attributes_value_wordlist', 'SUBSTRING_INDEX',
                              'TRUE');
        ctx_ddl.set_attribute('operations_workflow_attributes_value_wordlist', 'WILDCARD_INDEX',
                              'TRUE');
        -- Optional guardrails:
        -- ctx_ddl.set_attribute('operations_workflow_attributes_value_wordlist', 'WILDCARD_MAXTERMS', '5000');
      END;
      ]]></sql>

    <!-- CONTEXT index on VALUE; ON COMMIT keeps it up to date -->
    <sql><![CDATA[
      CREATE INDEX operations_workflow_attributes_value_ctx_idx
        ON operations_workflow_attributes (value)
        INDEXTYPE IS CTXSYS.CONTEXT
        PARAMETERS (
        'WORDLIST operations_workflow_attributes_value_wordlist
         SYNC (ON COMMIT)'
        );
      ]]>
    </sql>

    <rollback>
      <sql>DROP INDEX operations_workflow_attributes_value_ctx_idx</sql>
      <sql><![CDATA[
      BEGIN
        ctx_ddl.drop_preference('operations_workflow_attributes_value_wordlist');
      END;
      ]]>
      </sql>

      <sql>DROP INDEX operations_document_attributes_value_ctx_idx</sql>
      <sql><![CDATA[
      BEGIN
        ctx_ddl.drop_preference('operations_document_attributes_value_wordlist');
      END;
      ]]>
      </sql>
    </rollback>
  </changeSet>

</databaseChangeLog>